<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style> body { font-family: 'Kanit', sans-serif; } </style>
</head>
<body class="bg-gray-100 min-h-screen p-4">

    <div class="max-w-md mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="bg-blue-600 p-6 text-white">
            <h2 class="text-xl font-bold text-center mb-2">üîß ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ö‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</h2>
            <div class="bg-blue-500 rounded-lg p-4 text-sm space-y-2">
                <p><strong>üî¢ ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏á‡∏≤‡∏ô:</strong> <span id="showCaseId">...</span></p>
                <p><strong>üë§ ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á:</strong> <span id="showName">...</span></p>
                <p><strong>üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong> <a id="callLink" href="#" class="underline text-yellow-300">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏ó‡∏£‡∏≠‡∏≠‡∏Å</a></p>
                <p><strong>üìù ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:</strong> <span id="showDetail">...</span></p>
            </div>
        </div>

        <form id="techForm" class="p-6 space-y-6">
            <input type="hidden" name="caseId" id="caseId">
            <input type="hidden" name="userId" id="userId">
            <input type="hidden" name="actionType" id="actionType">

            <div class="border-b pb-6">
                <h3 class="font-bold text-gray-700 mb-2">1. ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</h3>
                <button type="button" onclick="submitForm('accept')" 
                        class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 rounded-lg shadow transition flex justify-center items-center gap-2">
                    üöß ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô (‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ)
                </button>
            </div>

            <div>
                <h3 class="font-bold text-gray-700 mb-2">2. ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô (‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß)</h3>
                <label class="block text-sm text-gray-600 mb-1">‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à *</label>
                <input type="file" name="image" id="imageInput" accept="image/*" class="w-full mb-3 text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-blue-50 file:text-blue-700">
                
                <textarea name="message" id="message" rows="2" class="w-full border rounded-lg p-2 mb-3" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö)"></textarea>

                <button type="button" onclick="submitForm('finish')" 
                        class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow transition flex justify-center items-center gap-2">
                    ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô (‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô)
                </button>
            </div>
        </form>
    </div>

    <div id="loading" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500"></div>
    </div>

    <script>
        // ‚ö†Ô∏è ‡πÉ‡∏™‡πà Webhook ‡∏≠‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        const WEBHOOK_URL = 'https://hook.eu1.make.com/xxxxxxxxxxxxxxxxxxxxxx'; 

        // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            document.getElementById('showCaseId').innerText = params.get('id') || '-';
            document.getElementById('showName').innerText = params.get('name') || '-';
            document.getElementById('showDetail').innerText = params.get('detail') || '-';
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏ó‡∏£‡∏≠‡∏≠‡∏Å
            const phone = params.get('phone') || '';
            document.getElementById('callLink').innerText = phone;
            document.getElementById('callLink').href = 'tel:' + phone;

            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏™‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏ô ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á
            document.getElementById('caseId').value = params.get('id');
            document.getElementById('userId').value = params.get('userid');
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        async function submitForm(type) {
            document.getElementById('actionType').value = type; // ‡∏ö‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏´‡∏ô (accept ‡∏´‡∏£‡∏∑‡∏≠ finish)
            
            // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏π‡∏õ
            if(type === 'finish') {
                const img = document.getElementById('imageInput');
                if(img.files.length === 0) { Swal.fire('‡∏•‡∏∑‡∏°‡∏£‡∏π‡∏õ', '‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö', 'warning'); return; }
            }

            document.getElementById('loading').classList.remove('hidden');
            const formData = new FormData(document.getElementById('techForm'));

            try {
                await fetch(WEBHOOK_URL, { method: 'POST', body: formData });
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success').then(() => window.close());
            } catch (err) {
                Swal.fire('Error', '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }
    </script>
</body>
</html>
